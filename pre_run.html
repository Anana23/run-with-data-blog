<!DOCTYPE HTML>
<!--
	Future Imperfect by HTML5 UP
	html5up.net | @ajlkn
-->
<html>
<head>
	<title>Run-with-data</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
</head>

<body class="is-preload">

<script data-goatcounter="https://runwithdata.goatcounter.com/count"
	async src="//gc.zgo.at/count.js"></script>

<!-- Wrapper -->
<div id="wrapper">

	<!-- Header -->
	<header id="header">
		<h1><a href="index.html">Run-with-data</a></h1>
		<nav class="links">
			<ul>
				<li><a href="#">Running</a></li>
				<li><a href="#">Data science</a></li>
			</ul>
		</nav>
		<nav class="main">
			<ul>
				<li class="search">
					<a class="fa-search" href="#search">Search</a>
					<form id="search" method="get" action="#">
						<input type="text" name="query" placeholder="Search" />
					</form>
				</li>
				<li class="menu">
					<a class="fa-bars" href="#menu">Menu</a>
				</li>
			</ul>
		</nav>
	</header>

	<!-- Menu -->
	<section id="menu">

		<section>
			<form class="search" method="get" action="#">
				<input type="text" name="query" placeholder="Search" />
			</form>
		</section>

		<section>
			<ul class="links">
				<li><a href="#"><h3>Running</h3></a></li>
				<li><a href="#"><h3>Data science</h3></a></li>
			</ul>
		</section>

		<section>
			<ul class="actions stacked">
				<li><a href="login.html" class="button large fit">Log In</a></li>
			</ul>
		</section>

	</section>

	<!-- Intro -->
	<section id="intro">
		<header>
			<h2 style="font-size: 1.5em;">Pre run</h2>
		</header>
	</section>

	<!-- Form -->
	<form id="input-form">

<div class="slider-row">
  <label for="motivation">Motivation (%)</label>
  <div class="slider-value-row">
    <span class="slider-value">50%</span>
    <input type="range" id="motivation" name="motivation" min="0" max="100" step="1" value="50">
  </div>
</div>


<div class="slider-row">
  <label for="energy">Energy (%)</label>
  <div class="slider-value-row">
    <span class="slider-value">50</span>
    <input type="range" id="energy" name="energy" min="0" max="100" step="1" value="50">
  </div>
</div>

<div class="slider-row">
  <label for="hip_pain">Hip Pain</label>
  <div class="slider-value-row">
    <span class="slider-value">2</span>
    <input type="range" id="hip_pain" name="hip_pain" min="0" max="5" step="1" value="2">
  </div>
</div>


<div class="slider-row">
  <label for="knee_pain">Knee Pain</label>
  <div class="slider-value-row">
    <span class="slider-value">1</span>
    <input type="range" id="knee_pain" name="knee_pain" min="0" max="5" step="1" value="1">
  </div>
</div>

		<!-- Digestive problems -->
		<p>Digestive problems (select all that apply):</p>

		<input type="checkbox" id="no" name="digestive_issues[]" value="no">
		<label for="no">No</label><br>

		<input type="checkbox" id="diarrhea" name="digestive_issues[]" value="diarrhea">
		<label for="diarrhea">Diarrhea</label><br>

		<input type="checkbox" id="constipation" name="digestive_issues[]" value="constipation">
		<label for="constipation">Constipation</label><br>

		<input type="checkbox" id="pain" name="digestive_issues[]" value="pain">
		<label for="pain">Pain</label><br>

		<input type="checkbox" id="stomach_issues" name="digestive_issues[]" value="stomach_issues">
		<label for="stomach_issues">Stomach issues</label><br>

		<!-- Mood -->
		<label for="mood">Mood:</label>
		<select id="mood" name="mood" required>
			<option value="">Select mood</option>
      <option value="good">Good</option>
      <option value="anxious">Anxious</option>
			<option value="happy">Happy</option>
			<option value="sad">Sad</option>
			<option value="stressed">Stressed</option>
			<option value="annoyed">Annoyed</option>
			<option value="angry">Angry</option>
			<option value="neutral">Neutral</option>
		</select>
<br>
    		<!-- Run type -->
		<label for="run_type">Planned run type:</label>
		<select id="run_type" name="run_type" required>
			<option value="">Select run type</option>
      <option value="short">Short (< 30 min)</option>
      <option value="intermediate">Intermediate (30 - 60 min)</option>
			<option value="long">Long (> 60 min)</option>
		</select>
<br>
    		<label for="run_intensity">Planned intensity:</label>
		<select id="run_intensity" name="run_intensity" required>
			<option value="">Select intensity</option>
      <option value="low">Low</option>
      <option value="intermediate">Intermediate</option>
			<option value="high">High</option>
		</select>

    <br>
		<!-- Food  -->
		<p>Food (select all that apply):</p>
		<input type="checkbox" id="no" name="food[]" value="no_food">
		<label for="no_food">No food</label><br>

		<input type="checkbox" id="coffee" name="food[]" value="coffee">
		<label for="coffee">Coffee (< 2h before)</label><br>

		<input type="checkbox" id="meal_lt_2h" name="food[]" value="meal_lt_2h">
		<label for="meal_lt_2h">Meal (< 2h before)</label><br>

		<input type="checkbox" id="meal_gt_2h" name="food[]" value="meal_gt_2h">
		<label for="meal_gt_2h">Meal (> 2h before)</label><br>

		<br><br>
		<button type="submit">Submit</button>

	</form>

	<!-- Logout -->
	<section>
		<ul class="actions stacked">
			<li><button id="logout-button" class="button large fit">Logout</button></li>
		</ul>
	</section>

	<p id="status-message"></p>

	<!-- Footer -->
	<section id="footer">
		<ul class="icons">
			<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
		</ul>
		<p class="copyright">
			&copy; Ana Strinic. Design: <a href="http://html5up.net">HTML5 UP</a>.
		</p>
	</section>

</div>

<!-- Scripts -->
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabase = createClient(
	'https://lsnwqvvhecpltfygjuhw.supabase.co',
	'sb_publishable_KH9p68D3_PevlnQJdYn_wg_T4SoN8bW'
);

// Redirect if not logged in
supabase.auth.onAuthStateChange((event, session) => {
	if (event === 'SIGNED_OUT' || !session) {
		window.location.href = "login.html";
	}
});

document.getElementById('input-form').addEventListener('submit', async (e) => {
	e.preventDefault();
	const form = e.target;
	const status = document.getElementById('status-message');

	const { data: { user } } = await supabase.auth.getUser();
	if (!user) {
		status.textContent = "User not logged in";
		status.style.color = "red";
		return;
	}

	const issues = Array.from(
		form.querySelectorAll('input[name="digestive_issues[]"]:checked')
	).map(cb => cb.value);

  	const food = Array.from(
		form.querySelectorAll('input[name="food[]"]:checked')
	).map(cb => cb.value);

	const data = {
		user_id: user.id,
		motivation: parseInt(form.motivation.value),
		energy: parseInt(form.energy.value),
		hip_pain: parseInt(form.hip_pain.value),
		knee_pain: parseInt(form.knee_pain.value),
		digestive_issues: issues,
    food: food,
		mood: form.mood.value,
    run_type: form.run_type.value,
    run_intensity: form.run_intensity.value
	};

	const { error } = await supabase.from('pre_run_data').insert([data]);

	if (error) {
		status.textContent = "Error: " + error.message;
		status.style.color = "red";
	} else {
		status.textContent = "Input saved!";
		status.style.color = "green";
		form.reset();
	}
});

// Logout
document.getElementById('logout-button').addEventListener('click', async () => {
	await supabase.auth.signOut();
	window.location.href = 'login.html';
});

// Show live values for all sliders
document.querySelectorAll('.slider-row').forEach(row => {
  const slider = row.querySelector('input[type="range"]');
  const valueEl = row.querySelector('.slider-value');

  const unit = slider.max === "100" ? "%" : ""; // % only for 0-100 sliders

  const update = () => {
    valueEl.textContent = slider.value + unit;
  };

  update();
  slider.addEventListener('input', update);
});


</script>


</body>
</html>
