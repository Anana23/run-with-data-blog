<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
</head>
<body>
</html>

<!DOCTYPE HTML>

<!--
	Future Imperfect by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Run-with-data</title>
        <p>Login successful.</p>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="is-preload">

		<script data-goatcounter="https://runwithdata.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>

	
		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<h1><a href="index.html">Run-with-data</a></h1>
						<nav class="links">
							<ul>
								<li><a href="#">Running</a></li>
								<li><a href="#">Data science</a></li>
							</ul>
						</nav>
						<nav class="main">
							<ul>
								<li class="search">
									<a class="fa-search" href="#search">Search</a>
									<form id="search" method="get" action="#">
										<input type="text" name="query" placeholder="Search" />
									</form>
								</li>
								<li class="menu">
									<a class="fa-bars" href="#menu">Menu</a>
								</li>
							</ul>
						</nav>
					</header>

				<!-- Menu -->
					<section id="menu">

						<!-- Search -->
							<section>
								<form class="search" method="get" action="#">
									<input type="text" name="query" placeholder="Search" />
								</form>
							</section>

						<!-- Links -->
							<section>
								<ul class="links">
									<li>
										<a href="#">
											<h3>Running</h3>
										</a>
									</li>
									<li>
										<a href="#">
											<h3>Data science</h3>
										</a>
									</li>
							</section>

						<!-- Actions -->
							<section>
								<ul class="actions stacked">
									<li><a href="login.html" class="button large fit">Log In</a></li>
								</ul>
							</section>

					</section>


				<!-- Sidebar -->
					<section id="sidebar">
					  <p>Please enter some text below to save it to the database:</p>

  <!-- Form to input text -->
  <form id="input-form">
    <label for="input-text">Text to insert:</label><br>
    <textarea id="input-text" rows="4" cols="50" required></textarea><br><br>
    <button type="submit">Submit</button>
  </form>

  <p id="status-message"></p>

	

						<!-- Footer -->
							<section id="footer">
								<ul class="icons">
									<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
								</ul>
								<p class="copyright">&copy; Ana Strinic, Website design template: <a href="http://html5up.net">HTML5 UP</a>. </p>
							</section>

					</section>

  <!-- Logout Button -->
  <button id="logout-button">Logout</button>

			</div>


  <!-- Importing Supabase JS SDK as an ES Module -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // Initialize the Supabase client
	export const supabase = createClient(
  'https://lsnwqvvhecpltfygjuhw.supabase.co',
  'sb_publishable_KH9p68D3_PevlnQJdYn_wg_T4SoN8bW'
)

    // Check if the user is authenticated
    supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_OUT' || !session) {
        window.location.href = "login.html"; // Redirect if not signed in
      }
    });

    // Handle form submission
      document.getElementById('input-form').addEventListener('submit', async (event) => {
      event.preventDefault();  // Prevent the form from reloading the page

      const inputText = document.getElementById('input-text').value.trim();
      const statusMessage = document.getElementById('status-message');

      if (inputText === '') {
        statusMessage.textContent = 'Please enter some text!';
        statusMessage.style.color = 'red';
        return;
      }

      try {
        // Insert the text into the `test_table`
        const { data, error } = await supabase
          .from('test_table')
          .insert([{ content: inputText }]);  // Assuming the column is named `text_column`

        if (error) {
          console.error('Error inserting data:', error.message);
          statusMessage.textContent = 'Error submitting text. Please try again.';
          statusMessage.style.color = 'red';
        } else {
          console.log('Text inserted:', data);
          statusMessage.textContent = 'Text successfully submitted!';
          statusMessage.style.color = 'green';

          // Clear the textarea
          document.getElementById('input-text').value = '';
        }
      } catch (error) {
        console.error('Unexpected error:', error.message);
        statusMessage.textContent = 'Something went wrong. Please try again.';
        statusMessage.style.color = 'red';
      }
    });

	
    // Logout function
    document.getElementById('logout-button').addEventListener('click', async () => {
      const { error } = await supabase.auth.signOut();
      if (error) {
        console.error('Error logging out:', error.message);
        alert('Error logging out. Please try again.');
      } else {
        window.location.href = 'login.html'; // Redirect to login page after logout
      }
    });


  </script>
</body>
</html>
